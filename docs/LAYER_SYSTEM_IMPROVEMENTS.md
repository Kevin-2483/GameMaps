# 地图编辑器图层系统改进

## 完成的修改

### 1. 数据模型更新
- **MapLayer 模型**: 添加了 `imageData` 字段用于存储 Base64 编码的图片数据
- **透明背景**: 移除了对封面图的依赖，默认使用透明背景
- **图片存储**: 图片数据直接存储在数据库中，不再使用文件路径

### 2. 图层面板布局优化
- **移除拖动标志**: 去掉了眼睛前面的可拖动图标，简化界面
- **两排布局**: 重新设计图层项布局为两排：
  - 第一排：图层名称 + 图片预览缩略图 (40x40)
  - 第二排：不透明度滑块 + 状态信息
- **增大预览**: 图片预览从 32x32 增大到 40x40 像素
- **状态显示**: 清晰显示"有背景图片"或"透明图层"状态

### 3. 图片管理功能
- **上传图片**: 支持 JPG、PNG、BMP、GIF 格式，最大 10MB
- **更换图片**: 可以随时更换图层的背景图片
- **移除图片**: 将图层恢复为透明状态
- **实时预览**: 图片预览支持透明度效果

### 4. 地图画布改进
- **透明背景**: 地图画布默认显示透明背景
- **图层堆叠**: 所有图层大小一致，按顺序堆叠显示
- **图片渲染**: 支持 Base64 图片数据的实时渲染

### 5. 工具类添加
- **ImageUtils**: 新增图片处理工具类
  - 图片选择和编码
  - Base64 解码和显示
  - 透明占位符生成
  - 图片尺寸获取

## 使用方法

### 创建图层
1. 点击图层面板的"添加图层"按钮
2. 新图层默认为透明背景
3. 可通过右侧菜单上传背景图片

### 管理图层图片
1. 点击图层右侧的图片管理按钮
2. 选择"上传图片"或"更换图片"
3. 选择图片文件（支持多种格式）
4. 如需移除，选择"移除图片"选项

### 调整图层
- **可见性**: 点击眼睛图标切换显示/隐藏
- **透明度**: 使用滑块调整图层透明度 (0-100%)
- **顺序**: 通过拖拽重新排列图层顺序

## 技术特点

- **数据完整性**: 图片数据存储在数据库中，无外部文件依赖
- **格式支持**: 支持主流图片格式，自动格式验证
- **大小限制**: 10MB 文件大小限制，防止数据库过载
- **错误处理**: 完善的错误处理和用户反馈
- **性能优化**: Base64 编码/解码，适合中小型图片

## 注意事项

1. **文件大小**: 建议使用压缩后的图片以节省存储空间
2. **格式兼容**: 支持的格式：JPG、JPEG、PNG、BMP、GIF
3. **透明图层**: 没有背景图片的图层会显示为透明
4. **数据备份**: 图片数据存储在数据库中，备份数据库即可保存所有图片
